<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="egrecho.core.module" href="module.html" /><link rel="prev" title="egrecho.core.feature_extractor" href="feature_extractor.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.08.06 -->
        <title>egrecho.core.loads - Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <em>Feedback welcomed 🎉 at <a href='http://xxx'>dummy url</a></em> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_dynamic_project.html">Dynamic Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../api.html">egrecho.core</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of egrecho.core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config.html">egrecho.core.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_builder.html">egrecho.core.data_builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="feature_extractor.html">egrecho.core.feature_extractor</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">egrecho.core.loads</a></li>
<li class="toctree-l2"><a class="reference internal" href="module.html">egrecho.core.module</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">egrecho.core.optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="parser.html">egrecho.core.parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="teacher.html">egrecho.core.teacher</a></li>
<li class="toctree-l2"><a class="reference internal" href="tokenizer.html">egrecho.core.tokenizer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html#egrecho-utils">egrecho.utils</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of egrecho.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html">egrecho.utils.apply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.common">egrecho.utils.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.constants">egrecho.utils.constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.cuda_utils">egrecho.utils.cuda_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.data_utils">egrecho.utils.data_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.dist">egrecho.utils.dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.imports">egrecho.utils.imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.logging">egrecho.utils.logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.mask">egrecho.utils.mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.misc">egrecho.utils.misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.register">egrecho.utils.register</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.torch_utils">egrecho.utils.torch_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.types">egrecho.utils.types</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-dummy">egrecho.utils.dummy</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of egrecho.utils.dummy</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.dummy.html">egrecho.utils.dummy.generate</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-io">egrecho.utils.io</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of egrecho.utils.io</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html">egrecho.utils.io.files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.kaldi">egrecho.utils.io.kaldi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.reader">egrecho.utils.io.reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.resolve_ckpt">egrecho.utils.io.resolve_ckpt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.utils">egrecho.utils.io.utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.writer">egrecho.utils.io.writer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-patch">egrecho.utils.patch</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.patch.html">egrecho.utils.patch.io_patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.patch.html#module-egrecho.utils.patch.torchdata_patch">egrecho.utils.patch.torchdata_patch</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../utils/egrecho.utils.patch.html#egrecho-utils-patch-simple-parse-patch">egrecho.utils.patch.simple_parse_patch</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch.simple_parse_patch</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html">egrecho.utils.patch.simple_parse_patch._utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#module-egrecho.utils.patch.simple_parse_patch.decoding">egrecho.utils.patch.simple_parse_patch.decoding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#module-egrecho.utils.patch.simple_parse_patch.serializable">egrecho.utils.patch.simple_parse_patch.serializable</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#egrecho-utils-patch-simple-parse-patch-annotation-utils">egrecho.utils.patch.simple_parse_patch.annotation_utils</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch.simple_parse_patch.annotation_utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.annotation_utils.html">egrecho.utils.patch.simple_parse_patch.annotation_utils</a></li>
<li class="toctree-l5"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.annotation_utils.html#module-egrecho.utils.patch.simple_parse_patch.annotation_utils.get_field_annotations">egrecho.utils.patch.simple_parse_patch.annotation_utils.get_field_annotations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-seeder">egrecho.utils.seeder</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of egrecho.utils.seeder</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.seeder.html">egrecho.utils.seeder.seed</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-text">egrecho.utils.text</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of egrecho.utils.text</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.text.html">egrecho.utils.text.cleaners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.text.html#module-egrecho.utils.text.number_cn">egrecho.utils.text.number_cn</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html#egrecho-pipeline">egrecho.pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of egrecho.pipeline</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/index.html">egrecho.pipeline.base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/index.html#module-egrecho.pipeline.speaker_embedding">egrecho.pipeline.speaker_embedding</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/wangers/subtools2/blob/master/docs/source/api/core/loads.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/wangers/subtools2/edit/master/docs/source/api/core/loads.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-egrecho.core.loads">
<span id="egrecho-core-loads"></span><h1>egrecho.core.loads<a class="headerlink" href="#module-egrecho.core.loads" title="Permalink to this heading">#</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.loads.HLoads">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">HLoads</span></span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L70-L197"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.HLoads" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="../utils/index.html#egrecho.utils.common.ObjectDict" title="egrecho.utils.common.ObjectDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObjectDict</span></code></a></p>
<p>Structs load parameters as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ecapa</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">EcapaModel</span>
    <span class="c1"># override_init_model_cfg</span>
    <span class="n">config</span><span class="p">:</span> <span class="p">{}</span>
    <span class="c1"># other kwargs placeholder</span>
    <span class="o">...</span>
<span class="n">feature_extractor</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_extractor_audio</span><span class="o">.</span><span class="n">KaldiFeatureExtractor</span>
    <span class="c1"># kwargs passing to _cls_.fetch_from</span>
    <span class="o">...</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.HLoads.from_config">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L112-L141"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.HLoads.from_config" title="Permalink to this definition">#</a></dt>
<dd><p>Creates hloads from config.</p>
<p>Input <code class="docutils literal notranslate"><span class="pre">config</span></code> can be an instance of <code class="docutils literal notranslate"><span class="pre">dict|str|Path|HLoads|MutableMapping</span></code>, the
**kwargs will be merged recursely into <code class="docutils literal notranslate"><span class="pre">config</span></code>.</p>
<blockquote>
<div><p>Normalize dict -&gt; Merge -&gt; (maybe) Omegaconf resolve -&gt; Instantiate -&gt; Output</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="#egrecho.core.loads.HLoads" title="egrecho.core.loads.HLoads"><code class="xref py py-class docutils literal notranslate"><span class="pre">HLoads</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MutableMapping</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Namespace</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]]</span>) -- The configuration.</p></li>
<li><p><strong>**kwargs</strong> -- Override kwargs</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The new hloads instance.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#egrecho.core.loads.HLoads" title="egrecho.core.loads.HLoads">HLoads</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.HLoads.to_cfg_file">
<span class="sig-name descname"><span class="pre">to_cfg_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L158-L169"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.HLoads.to_cfg_file" title="Permalink to this definition">#</a></dt>
<dd><p>Saves hloads.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- path to config file.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.HLoads.from_cfg_file">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_cfg_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L171-L185"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.HLoads.from_cfg_file" title="Permalink to this definition">#</a></dt>
<dd><p>Get hloads from file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- path to config file.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="#egrecho.core.loads.HLoads" title="egrecho.core.loads.HLoads"><code class="xref py py-class docutils literal notranslate"><span class="pre">HLoads</span></code></a></span></p>
</dd>
</dl>
<p>Returns:</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.loads.HResults">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">HResults</span></span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L211-L227"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.HResults" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="../utils/index.html#egrecho.utils.common.ObjectDict" title="egrecho.utils.common.ObjectDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">ObjectDict</span></code></a></p>
<p>Structs loaded result of <a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.fetch_from" title="egrecho.core.loads.SaveLoadHelper.fetch_from"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveLoadHelper.fetch_from</span></code></a>.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">SaveLoadHelper</span></span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L321-L910"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Save/load model in a directory, overwrite this for any special manners.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">egrecho.core.loads</span> <span class="kn">import</span> <span class="n">SaveLoadHelper</span>
<span class="kn">from</span> <span class="nn">egrecho.models.ecapa.model</span> <span class="kn">import</span> <span class="n">EcapaModel</span>
<span class="kn">from</span> <span class="nn">egrecho.data.features.feature_extractor_audio</span> <span class="kn">import</span> <span class="n">KaldiFeatureExtractor</span>
<span class="n">sl_helper</span> <span class="o">=</span> <span class="n">SaveLoadHelper</span><span class="p">()</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">KaldiFeatureExtractor</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="p">()</span>
<span class="n">dirpath</span> <span class="o">=</span> <span class="s1">&#39;testdir/ecapa&#39;</span>
<span class="n">sl_helper</span><span class="o">.</span><span class="n">save_to</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">model_or_state</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">components</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree testdir/ecapa
testdir/ecapa/
├── config
│   ├── feature_config.yaml
│   ├── model_config.yaml
│   └── types.yaml
└── model_weight.ckpt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">KaldiFeatureExtractor</span><span class="p">)</span>
<span class="c1"># hloads control random init</span>
<span class="n">hloads</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;random&#39;</span><span class="p">}}</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">)</span>
<span class="c1"># kwargs overrides to pretrained again</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;pretrained&#39;</span><span class="p">})</span>

<span class="c1"># now remove types.yaml</span>
<span class="c1"># rm -f testdir/ecapa/config/types.yaml</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="c1"># raise ConfigurationException: Failed request model type</span>
<span class="c1"># Let&#39;s complete the model type</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;egrecho.models.ecapa.model.EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># Type is ok</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">EcapaModel</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># classname string is ok as EcapaModel is already imported</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;Valle&#39;</span>
<span class="c1"># Error as &#39;Valle&#39; is not registed.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>  <span class="c1"># only load model without weight and eliminate the influences of Ecapa model directory</span>
<span class="kn">from</span> <span class="nn">egrecho.models.valle.model</span> <span class="kn">import</span> <span class="n">Valle</span>
<span class="c1"># Try again.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">Valle</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper.save_to">
<span class="sig-name descname"><span class="pre">save_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">savedir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_or_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L328-L389"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper.save_to" title="Permalink to this definition">#</a></dt>
<dd><p>Save model after pretraining.</p>
<p>Exports a pretrained model with its subcompnents (configs, tokenizer, etc …)
outdir like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./savedir
├── model_weight.ckpt
└── ./config
    ├── model_config.yaml
    ├── feature_config.yaml
    └── types.yaml
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>savedir</strong> -- local directory.</p></li>
<li><p><strong>model_or_state</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<a class="reference internal" href="module.html#egrecho.core.module.TopVirtualModel" title="egrecho.core.module.TopVirtualModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TopVirtualModel</span></code></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- TopVirtualModel object or model state dict to be saved.</p></li>
<li><p><strong>components</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]</span>) -- obj of tokenizer, feature extractor etc..</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">egrecho.core.loads</span> <span class="kn">import</span> <span class="n">SaveLoadHelper</span>
<span class="kn">from</span> <span class="nn">egrecho.models.ecapa.model</span> <span class="kn">import</span> <span class="n">EcapaModel</span>
<span class="kn">from</span> <span class="nn">egrecho.data.features.feature_extractor_audio</span> <span class="kn">import</span> <span class="n">KaldiFeatureExtractor</span>
<span class="n">sl_helper</span> <span class="o">=</span> <span class="n">SaveLoadHelper</span><span class="p">()</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">KaldiFeatureExtractor</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="p">()</span>
<span class="n">dirpath</span> <span class="o">=</span> <span class="s1">&#39;testdir/ecapa&#39;</span>
<span class="n">sl_helper</span><span class="o">.</span><span class="n">save_to</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">model_or_state</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">components</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree testdir/ecapa
testdir/ecapa/
├── config
│   ├── feature_config.yaml
│   ├── model_config.yaml
│   └── types.yaml
└── model_weight.ckpt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">KaldiFeatureExtractor</span><span class="p">)</span>
<span class="c1"># hloads control random init</span>
<span class="n">hloads</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;random&#39;</span><span class="p">}}</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">)</span>
<span class="c1"># kwargs overrides to pretrained again</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;pretrained&#39;</span><span class="p">})</span>

<span class="c1"># now remove types.yaml</span>
<span class="c1"># rm -f testdir/ecapa/config/types.yaml</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="c1"># raise ConfigurationException: Failed request model type</span>
<span class="c1"># Let&#39;s complete the model type</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;egrecho.models.ecapa.model.EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># Type is ok</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">EcapaModel</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># classname string is ok as EcapaModel is already imported</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;Valle&#39;</span>
<span class="c1"># Error as &#39;Valle&#39; is not registed.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>  <span class="c1"># only load model without weight and eliminate the influences of Ecapa model directory</span>
<span class="kn">from</span> <span class="nn">egrecho.models.valle.model</span> <span class="kn">import</span> <span class="n">Valle</span>
<span class="c1"># Try again.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">Valle</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper.fetch_from">
<span class="sig-name descname"><span class="pre">fetch_from</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">srcdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hloads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_model_cls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_hloads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwargs_recurse_override</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L391-L554"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper.fetch_from" title="Permalink to this definition">#</a></dt>
<dd><p>Load module class in Hloads. Return HResults dict contains (MODEL, FEATURE_EXTRACTOR, …), MODEL could be:</p>
<ul class="simple">
<li><p>A instance of model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> when skip_keys apply on model.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Workflow is defined as a sequence of the following operations:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Reslove hloads.</dt><dd><p>User could use config file or passing kwargs to control behaviour.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Load available class types via <code class="xref py py-meth docutils literal notranslate"><span class="pre">load_types_dict()</span></code>.</dt><dd><p>Note that passing classname as type is available if that class
is <strong>imported</strong> in current namespace and <strong>is a subclass of some base module</strong>, support
(<code class="xref py py-class docutils literal notranslate"><span class="pre">TopVirtualModel</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseFeaature</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseTokenizer</span></code>) now. E.g., instead of
passing a full class path: <code class="docutils literal notranslate"><span class="pre">'egrecho.models.ecapa.model.EcapaModel'</span></code>, user can first import
that class in python module act as a register manner, then the class name <code class="docutils literal notranslate"><span class="pre">'EcapaModel'</span></code> is
available. This mechianism could simplify parameter control.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Instantiate classes <code class="xref py py-meth docutils literal notranslate"><span class="pre">instantiate_classes()</span></code> according to typtes dict.</dt><dd><p>Specially, the model is loaded lazily, i.e., a tuple of (MODEL_CLS, INIT_MODEL_CFG, LEFT_MODEL_CFG)
resloved by <code class="docutils literal notranslate"><span class="pre">instantiate_model(lazy_model=True)</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Instantiate model <code class="xref py py-meth docutils literal notranslate"><span class="pre">_instantiate_model()</span></code>.</dt><dd><p>User might overwrite this method in subclasses.</p>
</dd>
</dl>
</li>
<li><p>Load model weight.</p></li>
</ol>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>srcdir</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>]</span>) -- <p>Model directory like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./srcdir
├── model_weight.ckpt
└── ./config
    ├── model_config.yaml
    ├── feature_config.yaml
    └── types.yaml
</pre></div>
</div>
</p></li>
<li><p><strong>hloads</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- <p>Path|str|Dict, optional
Hparam dict/file with hierarchical structure as in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ecapa</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">EcapaModel</span>
    <span class="c1"># override_init_model_cfg</span>
    <span class="n">config</span><span class="p">:</span> <span class="p">{}</span>
    <span class="c1"># other kwargs placeholder</span>
    <span class="o">...</span>
<span class="n">feature_extractor</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_extractor_audio</span><span class="o">.</span><span class="n">KaldiFeatureExtractor</span>
    <span class="c1"># kwargs passing to _cls_.fetch_from</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>You most likely won’t need this since default behaviours well. However, this arguments give a
chance to complete/override kwargs.</p>
</p></li>
<li><p><strong>base_model_cls</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- Base model class</p></li>
<li><p><strong>single_key</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- Load specify key.</p></li>
<li><p><strong>skip_keys</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Literal</span></code>[<code class="docutils literal notranslate"><span class="pre">'model'</span></code>, <code class="docutils literal notranslate"><span class="pre">'others'</span></code>, <code class="docutils literal notranslate"><span class="pre">'null'</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Set</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- Skip keys, e.g., skip model. Invalid when <code class="docutils literal notranslate"><span class="pre">single_key=True</span></code>.</p></li>
<li><p><strong>kwargs_recurse_override</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) -- Whether kwargs recursely overrides hloads.</p></li>
<li><p><strong>kwargs</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><em>Any</em><em>]</em>) -- <p>Overrides hloads.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Example of model-related params.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">init_weight</span><span class="o">=</span><span class="s1">&#39;last.ckpt&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>init_weight: Init weight from (‘pretrained’ or ‘random’), or string ckpt
name (model_weight.ckpt) or full path to ckpt /path/to/model_weight.ckpt.
Default: <code class="docutils literal notranslate"><span class="pre">'pretrained'</span></code></p></li>
<li><p>map_location: MAP_LOCATION_TYPE as in torch.load(). Defaults to ‘cpu’.
If you preferring to load a checkpoint saved a GPU model
to GPU, set it to None (not move to another GPU) or set a specified device.</p></li>
<li><p>strict : bool, optional, Whether to strictly enforce that the keys in checkpoint match
the keys returned by this module’s state dict. Defaults to True.</p></li>
</ul>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="#egrecho.core.loads.HResults" title="egrecho.core.loads.HResults"><code class="xref py py-class docutils literal notranslate"><span class="pre">HResults</span></code></a></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A HResults dict.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">egrecho.core.loads</span> <span class="kn">import</span> <span class="n">SaveLoadHelper</span>
<span class="kn">from</span> <span class="nn">egrecho.models.ecapa.model</span> <span class="kn">import</span> <span class="n">EcapaModel</span>
<span class="kn">from</span> <span class="nn">egrecho.data.features.feature_extractor_audio</span> <span class="kn">import</span> <span class="n">KaldiFeatureExtractor</span>
<span class="n">sl_helper</span> <span class="o">=</span> <span class="n">SaveLoadHelper</span><span class="p">()</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">KaldiFeatureExtractor</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="p">()</span>
<span class="n">dirpath</span> <span class="o">=</span> <span class="s1">&#39;testdir/ecapa&#39;</span>
<span class="n">sl_helper</span><span class="o">.</span><span class="n">save_to</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span><span class="n">model_or_state</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">components</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree testdir/ecapa
testdir/ecapa/
├── config
│   ├── feature_config.yaml
│   ├── model_config.yaml
│   └── types.yaml
└── model_weight.ckpt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">KaldiFeatureExtractor</span><span class="p">)</span>
<span class="c1"># hloads control random init</span>
<span class="n">hloads</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;random&#39;</span><span class="p">}}</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">)</span>
<span class="c1"># kwargs overrides to pretrained again</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">hloads</span><span class="o">=</span><span class="n">hloads</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;init_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;pretrained&#39;</span><span class="p">})</span>

<span class="c1"># now remove types.yaml</span>
<span class="c1"># rm -f testdir/ecapa/config/types.yaml</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="c1"># raise ConfigurationException: Failed request model type</span>
<span class="c1"># Let&#39;s complete the model type</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;egrecho.models.ecapa.model.EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># Type is ok</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">EcapaModel</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># classname string is ok as EcapaModel is already imported</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;EcapaModel&#39;</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">single_key</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;_cls_&#39;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">})</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;Valle&#39;</span>
<span class="c1"># Error as &#39;Valle&#39; is not registed.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>  <span class="c1"># only load model without weight and eliminate the influences of Ecapa model directory</span>
<span class="kn">from</span> <span class="nn">egrecho.models.valle.model</span> <span class="kn">import</span> <span class="n">Valle</span>
<span class="c1"># Try again.</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">sl_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">single_key</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>
    <span class="n">kwargs_recurse_override</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;_cls_&quot;</span><span class="p">:</span> <span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;init_weight&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">Valle</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper.load_model_with_components">
<span class="sig-name descname"><span class="pre">load_model_with_components</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hloads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_model_cls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skip_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">single_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lazy_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L713-L792"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper.load_model_with_components" title="Permalink to this definition">#</a></dt>
<dd><p>Load module class in Hloads. Return tuple contains (MODEL, COMPONETS, HLOADS), where TYPES_DICT
indicates what classes will be used to instance an object. Model could be:</p>
<ul class="simple">
<li><p>A tuple of (MODEL_INSTANCE, LEFT_MODEL_CFG).</p></li>
<li><p>A tuple of (MODEL_CLS, INIT_MODEL_CFG, LEFT_MODEL_CFG) resloved as lazy model in <code class="xref py py-meth docutils literal notranslate"><span class="pre">_instantiate_model()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> when skip_keys apply on model.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cfg_dir</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) -- Directory contains cfg files.</p></li>
<li><p><strong>hloads</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="#egrecho.core.loads.HLoads" title="egrecho.core.loads.HLoads"><code class="xref py py-class docutils literal notranslate"><span class="pre">HLoads</span></code></a>]</span>) -- <p>Path|str|Dict, optional
Hparam dict/file with hierarchical structure as in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ecapa</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">EcapaModel</span>
    <span class="c1"># replace default model_config.yaml</span>
    <span class="n">config_fname</span><span class="p">:</span> <span class="n">some_config</span><span class="o">.</span><span class="n">yaml</span>
    <span class="c1"># override_init_model_cfg</span>
    <span class="n">config</span><span class="p">:</span> <span class="p">{}</span>
    <span class="c1"># other kwargs placeholder</span>
    <span class="o">...</span>
<span class="n">feature_extractor</span><span class="p">:</span>
    <span class="n">_cls_</span><span class="p">:</span> <span class="n">egrecho</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">feature_extractor_audio</span><span class="o">.</span><span class="n">KaldiFeatureExtractor</span>
    <span class="c1"># kwargs passing to _cls_.fetch_from</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>You most likely won’t need this since default behaviours well. However, this arguments give a
chance to complete/override kwargs.</p>
</p></li>
<li><p><strong>base_model_cls</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- Base model class</p></li>
<li><p><strong>single_key</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- Load specify key.</p></li>
<li><p><strong>skip_keys</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Literal</span></code>[<code class="docutils literal notranslate"><span class="pre">'model'</span></code>, <code class="docutils literal notranslate"><span class="pre">'others'</span></code>, <code class="docutils literal notranslate"><span class="pre">'null'</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Set</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- Skip keys, e.g., skip model. Invalid when <code class="docutils literal notranslate"><span class="pre">single_key=True</span></code>.</p></li>
<li><p><strong>lazy_model</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) -- If False, instantiate model else just left mode cls with its init cfg.
Default: False</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]], <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <a class="reference internal" href="#egrecho.core.loads.HLoads" title="egrecho.core.loads.HLoads"><code class="xref py py-class docutils literal notranslate"><span class="pre">HLoads</span></code></a>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple contains (MODEL, COMPONETS, HLOADS).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper.modify_state_dict">
<span class="sig-name descname"><span class="pre">modify_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_cfg</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L885-L894"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper.modify_state_dict" title="Permalink to this definition">#</a></dt>
<dd><p>Allows to modify the state dict before loading parameters into a model.
:type state_dict: 
:param state_dict: The state dict restored from the checkpoint.
:type model_cfg: 
:param model_cfg: A model level dict object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A potentially modified state dict.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.loads.SaveLoadHelper.load_instance_with_state_dict">
<span class="sig-name descname"><span class="pre">load_instance_with_state_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L896-L905"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SaveLoadHelper.load_instance_with_state_dict" title="Permalink to this definition">#</a></dt>
<dd><p>Utility method that loads a model instance with the (potentially modified) state dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instance</strong> -- ModelPT subclass instance.</p></li>
<li><p><strong>state_dict</strong> -- The state dict (which may have been modified)</p></li>
<li><p><strong>strict</strong> -- Bool, whether to perform strict checks when loading the state dict.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.save_ckpt_conf_dir">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">save_ckpt_conf_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ckptdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_conf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extractor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_extractor_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/utils/misc.py#L913-L987"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.save_ckpt_conf_dir" title="Permalink to this definition">#</a></dt>
<dd><p>Makes it convenient to load from pretrained, save extractor, model_type, etc.. to a dir.</p>
<p>Construct a dir like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./ckptdir
└── ./config
    ├── model_config.yaml
    ├── feature_config.yaml
    └── types.yaml
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ckptdir</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) -- the parent of savedir, it will create a <code class="docutils literal notranslate"><span class="pre">config</span></code> subdir as a placeholder of files.</p></li>
<li><p><strong>model_conf</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]</span>) -- a dict of model config.</p></li>
<li><p><strong>extractor</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <a class="reference internal" href="feature_extractor.html#egrecho.core.feature_extractor.BaseFeature" title="egrecho.core.feature_extractor.BaseFeature"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseFeature</span></code></a>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- extractor can be either a dict or a instance of
<a class="reference internal" href="feature_extractor.html#egrecho.core.feature_extractor.BaseFeature" title="egrecho.core.feature_extractor.BaseFeature"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseFeature</span></code></a>.</p></li>
<li><p><strong>model_type</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- model class type or class import path.</p></li>
<li><p><strong>feature_extractor_type</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- feature extractor class type or class import path.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.loads.ResolveModelResult">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">ResolveModelResult</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L991-L1005"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.ResolveModelResult" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Resolved opts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>checkpoint</strong> (<em>str</em>) -- ckpt weight path</p></li>
<li><p><strong>model_type</strong> (<em>str</em>) -- model type string.</p></li>
<li><p><strong>feature_config</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]</span>) -- loaded dict of feature extractor config.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.resolve_pretrained_model">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">resolve_pretrained_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'last.ckpt'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dirpath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_k_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'min'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'version'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extractor_fname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'feature_config.yaml'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">resolve_ckpt_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L1008-L1082"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.resolve_pretrained_model" title="Permalink to this definition">#</a></dt>
<dd><p>Resolves <code class="docutils literal notranslate"><span class="pre">checkpoint</span></code>, <code class="docutils literal notranslate"><span class="pre">model_type</span></code>, <code class="docutils literal notranslate"><span class="pre">feats_config</span></code>.</p>
<p>Checkpoint resolving see <a class="reference internal" href="../utils/egrecho.utils.io.html#egrecho.utils.io.resolve_ckpt.resolve_ckpt" title="egrecho.utils.io.resolve_ckpt.resolve_ckpt"><code class="xref py py-func docutils literal notranslate"><span class="pre">resolve_ckpt()</span></code></a> for details.
Auto resolve local dir like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>./dirpath/version_1
        └── checkpoints
            ├── best_k_models.yaml
            ├── last.ckpt
            ├── abc.ckpt
            └── ./config
                ├── model_config.yaml
                ├── feature_config.yaml
                └── types.yaml
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>checkpoint</strong> (<em>str</em><em>, </em><em>optional</em>) -- The file name of checkpoint to resolve, local file needs a suffix like <code class="docutils literal notranslate"><span class="pre">&quot;.ckpt&quot;</span> <span class="pre">/</span> <span class="pre">&quot;.pt&quot;</span></code>,
While <code class="docutils literal notranslate"><span class="pre">checkpoint=&quot;best&quot;</span></code> is a preseved key means it will find <code class="docutils literal notranslate"><span class="pre">best_k_fname</span></code> which is
a file contains Dict[BEST_K_MODEL_PATH, BEST_K_SCORE], and sort by its score to
match a best ckpt. Defaults to “last.ckpt”.</p></li>
<li><p><strong>dirpath</strong> (<em>Path</em><em> or </em><em>str</em><em>, </em><em>optional</em>) -- The root path. Defaults to None, which means the current directory.</p></li>
<li><p><strong>version</strong> (<em>str</em><em>, </em><em>optional</em>) -- The versioned subdir name. Conmmonly subdir is named as “version_0/version_1”, if you specify
the version name with a version num, it will search that version dir, otherwise choose the max number
of version (above “version_1”). Defaults to “version”.</p></li>
<li><p><strong>best_k_mode</strong> (<em>Literal</em><em>[</em><em>&quot;max&quot;</em><em>, </em><em>&quot;min&quot;</em><em>]</em><em>, </em><em>optional</em>) -- The mode for selecting the best_k checkpoint. Defaults to “min”.</p></li>
<li><p><strong>extractor_fname</strong> (<em>str</em>) -- feature extractor file name, defaults to <code class="docutils literal notranslate"><span class="pre">&quot;feature_config.yaml&quot;</span></code>, search in <code class="docutils literal notranslate"><span class="pre">config/</span></code> subdir.</p></li>
<li><p><strong>resolve_ckpt_kwargs</strong> (<em>dict</em>) -- additional kwargs to <a class="reference internal" href="../utils/egrecho.utils.io.html#egrecho.utils.io.resolve_ckpt.resolve_ckpt" title="egrecho.utils.io.resolve_ckpt.resolve_ckpt"><code class="xref py py-func docutils literal notranslate"><span class="pre">resolve_ckpt()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="#egrecho.core.loads.ResolveModelResult" title="egrecho.core.loads.ResolveModelResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResolveModelResult</span></code></a></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.load_module_class">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">load_module_class</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_module_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/utils/misc.py#L1099-L1138"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.load_module_class" title="Permalink to this definition">#</a></dt>
<dd><p>Given a import path which contains class and returns the class type.</p>
<p>If import path is full format, it should be dot import format and the last part is the
class name.</p>
<p>If only provide model class name (without dot “.”), it will resolve the subclasses of <code class="docutils literal notranslate"><span class="pre">base_module_type</span></code>
which have been registered via <cite>imports</cite> in python file and match the model name in the last part.
if one name matches more than one model class, it’will failed and you need provide the full path
to elimiate ambiguity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_path</strong> (<em>str</em>) -- The import path containing the module class. For the case only provide class name,
that class should be registered by <code class="docutils literal notranslate"><span class="pre">import</span></code> in your python.</p></li>
<li><p><strong>base_module_type</strong> (<em>Type</em><em>, </em><em>optional</em>) -- The base class type to check against.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The class type loaded from the module path.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Type</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.load_model_type">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">load_model_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_module_type=&lt;class</span> <span class="pre">'egrecho.core.module.TopVirtualModel'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L1141-L1145"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.load_model_type" title="Permalink to this definition">#</a></dt>
<dd><p>Given a import path which contains class and returns the class type.</p>
<p>If import path is full format, it should be dot import format and the last part is the
class name.</p>
<p>If only provide model class name (without dot “.”), it will resolve the subclasses of <code class="docutils literal notranslate"><span class="pre">base_module_type</span></code>
which have been registered via <cite>imports</cite> in python file and match the model name in the last part.
if one name matches more than one model class, it’will failed and you need provide the full path
to elimiate ambiguity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_path</strong> (<em>str</em>) -- The import path containing the module class. For the case only provide class name,
that class should be registered by <code class="docutils literal notranslate"><span class="pre">import</span></code> in your python.</p></li>
<li><p><strong>base_module_type</strong> (<em>Type</em><em>, </em><em>optional</em>) -- The base class type to check against.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The class type loaded from the module path.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Type</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.load_extractor_type">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">load_extractor_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_module_type=&lt;class</span> <span class="pre">'egrecho.core.feature_extractor.BaseFeature'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L1148-L1152"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.load_extractor_type" title="Permalink to this definition">#</a></dt>
<dd><p>Given a import path which contains class and returns the class type.</p>
<p>If import path is full format, it should be dot import format and the last part is the
class name.</p>
<p>If only provide model class name (without dot “.”), it will resolve the subclasses of <code class="docutils literal notranslate"><span class="pre">base_module_type</span></code>
which have been registered via <cite>imports</cite> in python file and match the model name in the last part.
if one name matches more than one model class, it’will failed and you need provide the full path
to elimiate ambiguity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_path</strong> (<em>str</em>) -- The import path containing the module class. For the case only provide class name,
that class should be registered by <code class="docutils literal notranslate"><span class="pre">import</span></code> in your python.</p></li>
<li><p><strong>base_module_type</strong> (<em>Type</em><em>, </em><em>optional</em>) -- The base class type to check against.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The class type loaded from the module path.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Type</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="egrecho.core.loads.load_extend_default_type">
<span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">load_extend_default_type</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">module_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L1155-L1180"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.load_extend_default_type" title="Permalink to this definition">#</a></dt>
<dd><p>Allows simple class name when <code class="docutils literal notranslate"><span class="pre">default_type</span></code> is provided.</p>
<ul class="simple">
<li><p>If import path is dot “calender.Calender” format, it should be full import format and the last part is the
class name. Note that <code class="docutils literal notranslate"><span class="pre">default_type</span></code> is <strong>ignored</strong> in this case.</p></li>
<li><p>If only provide model class name (without dot “.”), must provide <code class="docutils literal notranslate"><span class="pre">default_type</span></code> as <code class="docutils literal notranslate"><span class="pre">base_module_type</span></code>,
then it will resolve the subclasses of <code class="docutils literal notranslate"><span class="pre">default_type</span></code> which have been registered via <cite>imports</cite> in python
file and match the model name in the last part. If one name matches more than one model class,
it’will failed and you need provide the full path to elimiate ambiguity.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>module_path</strong> (<em>str</em>) -- The import path containing the module class. For the case only provide class name,
that class should be a subclass of <code class="docutils literal notranslate"><span class="pre">default_type</span></code> registered by <code class="docutils literal notranslate"><span class="pre">import</span></code> in your python.</p></li>
<li><p><strong>default_type</strong> (<em>Type</em><em>, </em><em>optional</em>) -- The default class type.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The class type loaded from the module path.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Type</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.loads.SpecialSkipType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.loads.</span></span><span class="sig-name descname"><span class="pre">SpecialSkipType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/loads.py#L1233-L1246"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.loads.SpecialSkipType" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="../utils/index.html#egrecho.utils.types.StrEnum" title="egrecho.utils.types.StrEnum"><code class="xref py py-class docutils literal notranslate"><span class="pre">StrEnum</span></code></a></p>
<p>Special skip mode when loading module.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model</span></code>: exclude model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">others</span></code>: only model.</p></li>
</ul>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="module.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">egrecho.core.module</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="feature_extractor.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">egrecho.core.feature_extractor</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Dexin Liao
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">egrecho.core.loads</a><ul>
<li><a class="reference internal" href="#egrecho.core.loads.HLoads"><code class="docutils literal notranslate"><span class="pre">HLoads</span></code></a><ul>
<li><a class="reference internal" href="#egrecho.core.loads.HLoads.from_config"><code class="docutils literal notranslate"><span class="pre">HLoads.from_config()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.HLoads.to_cfg_file"><code class="docutils literal notranslate"><span class="pre">HLoads.to_cfg_file()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.HLoads.from_cfg_file"><code class="docutils literal notranslate"><span class="pre">HLoads.from_cfg_file()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#egrecho.core.loads.HResults"><code class="docutils literal notranslate"><span class="pre">HResults</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper</span></code></a><ul>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.save_to"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper.save_to()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.fetch_from"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper.fetch_from()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.load_model_with_components"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper.load_model_with_components()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.modify_state_dict"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper.modify_state_dict()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SaveLoadHelper.load_instance_with_state_dict"><code class="docutils literal notranslate"><span class="pre">SaveLoadHelper.load_instance_with_state_dict()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#egrecho.core.loads.save_ckpt_conf_dir"><code class="docutils literal notranslate"><span class="pre">save_ckpt_conf_dir()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.ResolveModelResult"><code class="docutils literal notranslate"><span class="pre">ResolveModelResult</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.resolve_pretrained_model"><code class="docutils literal notranslate"><span class="pre">resolve_pretrained_model()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.load_module_class"><code class="docutils literal notranslate"><span class="pre">load_module_class()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.load_model_type"><code class="docutils literal notranslate"><span class="pre">load_model_type()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.load_extractor_type"><code class="docutils literal notranslate"><span class="pre">load_extractor_type()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.load_extend_default_type"><code class="docutils literal notranslate"><span class="pre">load_extend_default_type()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.loads.SpecialSkipType"><code class="docutils literal notranslate"><span class="pre">SpecialSkipType</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=4ea706d9"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>