<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="egrecho.core.optimization" href="optimization.html" /><link rel="prev" title="egrecho.core.loads" href="loads.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.07.18 -->
        <title>egrecho.core.module - Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=613ab9ff" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     <em>Feedback welcomed ðŸŽ‰ at <a href='http://xxx'>dummy url</a></em> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">Documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial_dynamic_project.html">Dynamic Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../api.html">egrecho.core</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of egrecho.core</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config.html">egrecho.core.config</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_builder.html">egrecho.core.data_builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="feature_extractor.html">egrecho.core.feature_extractor</a></li>
<li class="toctree-l2"><a class="reference internal" href="loads.html">egrecho.core.loads</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">egrecho.core.module</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">egrecho.core.optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="parser.html">egrecho.core.parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="teacher.html">egrecho.core.teacher</a></li>
<li class="toctree-l2"><a class="reference internal" href="tokenizer.html">egrecho.core.tokenizer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html#egrecho-utils">egrecho.utils</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of egrecho.utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html">egrecho.utils.apply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.common">egrecho.utils.common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.constants">egrecho.utils.constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.cuda_utils">egrecho.utils.cuda_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.data_utils">egrecho.utils.data_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.dist">egrecho.utils.dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.imports">egrecho.utils.imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.logging">egrecho.utils.logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.mask">egrecho.utils.mask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.misc">egrecho.utils.misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.register">egrecho.utils.register</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.torch_utils">egrecho.utils.torch_utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#module-egrecho.utils.types">egrecho.utils.types</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-dummy">egrecho.utils.dummy</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of egrecho.utils.dummy</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.dummy.html">egrecho.utils.dummy.generate</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-io">egrecho.utils.io</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of egrecho.utils.io</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html">egrecho.utils.io.files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.kaldi">egrecho.utils.io.kaldi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.reader">egrecho.utils.io.reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.resolve_ckpt">egrecho.utils.io.resolve_ckpt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.utils">egrecho.utils.io.utils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.io.html#module-egrecho.utils.io.writer">egrecho.utils.io.writer</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-patch">egrecho.utils.patch</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.patch.html">egrecho.utils.patch.io_patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.patch.html#module-egrecho.utils.patch.torchdata_patch">egrecho.utils.patch.torchdata_patch</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../utils/egrecho.utils.patch.html#egrecho-utils-patch-simple-parse-patch">egrecho.utils.patch.simple_parse_patch</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch.simple_parse_patch</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html">egrecho.utils.patch.simple_parse_patch._utils</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#module-egrecho.utils.patch.simple_parse_patch.decoding">egrecho.utils.patch.simple_parse_patch.decoding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#module-egrecho.utils.patch.simple_parse_patch.serializable">egrecho.utils.patch.simple_parse_patch.serializable</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.html#egrecho-utils-patch-simple-parse-patch-annotation-utils">egrecho.utils.patch.simple_parse_patch.annotation_utils</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of egrecho.utils.patch.simple_parse_patch.annotation_utils</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.annotation_utils.html">egrecho.utils.patch.simple_parse_patch.annotation_utils</a></li>
<li class="toctree-l5"><a class="reference internal" href="../utils/egrecho.utils.patch.simple_parse_patch.annotation_utils.html#module-egrecho.utils.patch.simple_parse_patch.annotation_utils.get_field_annotations">egrecho.utils.patch.simple_parse_patch.annotation_utils.get_field_annotations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-seeder">egrecho.utils.seeder</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of egrecho.utils.seeder</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.seeder.html">egrecho.utils.seeder.seed</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../utils/index.html#egrecho-utils-text">egrecho.utils.text</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of egrecho.utils.text</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.text.html">egrecho.utils.text.cleaners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/egrecho.utils.text.html#module-egrecho.utils.text.number_cn">egrecho.utils.text.number_cn</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html#egrecho-pipeline">egrecho.pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of egrecho.pipeline</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/index.html">egrecho.pipeline.base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline/index.html#module-egrecho.pipeline.speaker_embedding">egrecho.pipeline.speaker_embedding</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/wangers/subtools2/blob/master/docs/source/api/core/module.md?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/wangers/subtools2/edit/master/docs/source/api/core/module.md" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="module-egrecho.core.module">
<span id="egrecho-core-module"></span><h1>egrecho.core.module<a class="headerlink" href="#module-egrecho.core.module" title="Permalink to this heading">#</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.module.</span></span><span class="sig-name descname"><span class="pre">TopVirtualModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L100-L583"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LightningModule</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GenericFileMixin</span></code></p>
<p>A lightning module which is related to training, val, test.</p>
<p>In fit (train + validate) stage, you need to set <code class="docutils literal notranslate"><span class="pre">self.teacher</span></code>, where configures
step logics, dataloaders, criterion, etc.</p>
<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.setup">
<span class="sig-name descname"><span class="pre">setup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stage</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L130-L170"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.setup" title="Permalink to this definition">#</a></dt>
<dd><p>Hook of <code class="xref py py-meth docutils literal notranslate"><span class="pre">lightning.pytorch.core.hooks.DataHooks.setup()</span></code>.</p>
<p>Called this at the beginning of fit (train + validate), validate, test, or predict. This is a good hook when
you need to build models dynamically or adjust something about them. This hook is called on every process
when using DDP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stage</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) -- either <code class="docutils literal notranslate"><span class="pre">'fit'</span></code>, <code class="docutils literal notranslate"><span class="pre">'validate'</span></code>, <code class="docutils literal notranslate"><span class="pre">'test'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'predict'</span></code></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">LitModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">if</span> <span class="n">stage</span> <span class="o">==</span> <span class="s1">&#39;fit&#39;</span><span class="p">:</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="o">.</span><span class="n">setup_model</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">LitTeacher</span><span class="p">(</span><span class="n">Teacher</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">setup_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">pass</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LitModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">teacher</span> <span class="o">=</span> <span class="n">LitTeacher</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">teacher</span> <span class="o">=</span> <span class="n">teacher</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">l1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">classifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.training_step">
<span class="sig-name descname"><span class="pre">training_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L205-L213"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.training_step" title="Permalink to this definition">#</a></dt>
<dd><p>Redirection to <a class="reference internal" href="#egrecho.core.module.TopVirtualModel.training_step" title="egrecho.core.module.TopVirtualModel.training_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">training_step()</span></code></a> in teacher.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.validation_step">
<span class="sig-name descname"><span class="pre">validation_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L215-L223"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.validation_step" title="Permalink to this definition">#</a></dt>
<dd><p>Redirection to <a class="reference internal" href="#egrecho.core.module.TopVirtualModel.training_step" title="egrecho.core.module.TopVirtualModel.training_step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">training_step()</span></code></a> in teacher.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.pipeline_out">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">pipeline_out</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_out</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L225-L230"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.pipeline_out" title="Permalink to this definition">#</a></dt>
<dd><p>Transform output (<code class="xref py py-meth docutils literal notranslate"><span class="pre">forward()</span></code>) to dict for pipeline. write it for your specify model.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.on_train_start">
<span class="sig-name descname"><span class="pre">on_train_start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L232-L242"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.on_train_start" title="Permalink to this definition">#</a></dt>
<dd><p>Called at the very beginning of train.</p>
<p>If on DDP it is called on every process</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.on_train_end">
<span class="sig-name descname"><span class="pre">on_train_end</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L244-L254"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.on_train_end" title="Permalink to this definition">#</a></dt>
<dd><p>Called at the very end of train.</p>
<p>If on DDP it is called on every process</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.configure_optimizers">
<span class="sig-name descname"><span class="pre">configure_optimizers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L256-L264"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.configure_optimizers" title="Permalink to this definition">#</a></dt>
<dd><p>Redirection to <a class="reference internal" href="#egrecho.core.module.TopVirtualModel.configure_optimizers" title="egrecho.core.module.TopVirtualModel.configure_optimizers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">configure_optimizers()</span></code></a> in teacher.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.configure_teacher_callbacks">
<span class="sig-name descname"><span class="pre">configure_teacher_callbacks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L266-L307"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.configure_teacher_callbacks" title="Permalink to this definition">#</a></dt>
<dd><p>Configure teacher-specific callbacks.</p>
<p>Manually call this funtion to get callbacks and add them to your trainer.</p>
<dl>
<dt>Example::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">LitTeacher</span><span class="p">(</span><span class="n">Teacher</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">setup_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">configure_teacher_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">[</span><span class="n">PrintCallback</span><span class="p">()]</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">PrintCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training is started!&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">on_train_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training is done.&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">LitModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span> <span class="o">=</span> <span class="n">teacher</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">teacher</span><span class="o">.</span><span class="n">setup_model</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">teacher</span> <span class="o">=</span> <span class="n">LitTeacher</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LitModel</span><span class="p">(</span><span class="n">teacher</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_callbacks</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">configure_teacher_callbacks</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span><span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;gpu&quot;</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">t_callbacks</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.from_pretrained">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_pretrained</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">checkpoint_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_location</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hparams_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_mismatched_sizes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L309-L364"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.from_pretrained" title="Permalink to this definition">#</a></dt>
<dd><p>Load pretrained model from checkpoint.</p>
<p>This is raw now, to be implemented.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>checkpoint_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- Path to checkpoint. This can also be a URL, or file-like object.</p></li>
<li><p><strong>map_location</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</span>) -- <p>MAP_LOCATION_TYPE as in torch.load(). Defaults to â€˜cpuâ€™.</p>
<p>If you preferring to load a checkpoint saved a GPU model
to GPU, set it to None (not move to another GPU) or set a specified device.</p>
</p></li>
<li><p><strong>hparams_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- <p>Path or str, optional
Path to a .yaml file with hierarchical structure
as in this example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_classes</span><span class="p">:</span> <span class="mi">5994</span>
<span class="n">config</span><span class="p">:</span>
    <span class="n">channels</span><span class="p">:</span> <span class="mi">1024</span>
</pre></div>
</div>
<p>You most likely wonâ€™t need this since Lightning will always save the
hyperparameters to the checkpoint. However, if your checkpoint weights
do not have the hyperparameters saved, use this method to pass in a .yaml
file with the hparams you would like to use. These will be converted
into a dict and passed into your Model for use.</p>
</p></li>
<li><p><strong>ignore_mismatched_sizes</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) -- bool
Whether or not to raise an error if some of the weights from the checkpoint do not have the same size
as the weights of the model (if for instance, you are instantiating a model with 10 labels from a
checkpoint with 3 labels). Defaults to False.</p></li>
<li><p><strong>strict</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) -- bool, optional
Whether to strictly enforce that the keys in checkpoint match
the keys returned by this moduleâ€™s state dict. Defaults to True.</p></li>
<li><p><strong>kwargs</strong> -- optional
Any extra keyword args needed to init the model.
Can also be used to override saved hyperparameter values.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><a class="reference internal" href="#egrecho.core.module.TopVirtualModel" title="egrecho.core.module.TopVirtualModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">TopVirtualModel</span></code></a></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.save_to">
<span class="sig-name descname"><span class="pre">save_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">savedir</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L366-L380"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.save_to" title="Permalink to this definition">#</a></dt>
<dd><p>Saves to a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>savedir</strong> -- path</p></li>
<li><p><strong>**kwargs</strong> -- args passing to <a class="reference internal" href="loads.html#egrecho.core.loads.SaveLoadHelper.save_to" title="egrecho.core.loads.SaveLoadHelper.save_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_to()</span></code></a> of object
of <a class="reference internal" href="loads.html#egrecho.core.loads.SaveLoadHelper" title="egrecho.core.loads.SaveLoadHelper"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveLoadHelper</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">egrecho.models.ecapa.model</span> <span class="kn">import</span> <span class="n">EcapaModel</span>
<span class="kn">from</span> <span class="nn">egrecho.data.features.feature_extractor_audio</span> <span class="kn">import</span> <span class="n">KaldiFeatureExtractor</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">KaldiFeatureExtractor</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="p">()</span>
<span class="n">dirpath</span> <span class="o">=</span> <span class="s1">&#39;testdir/ecapa&#39;</span>
<span class="n">model</span><span class="o">.</span><span class="n">save_to</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree testdir/ecapa
testdir/ecapa/
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ feature_config.yaml
â”‚   â”œâ”€â”€ model_config.yaml
â”‚   â””â”€â”€ types.yaml
â””â”€â”€ model_weight.ckpt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># fetch extractor</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">save_load_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">skip_keys</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">KaldiFeatureExtractor</span><span class="p">)</span>
<span class="c1"># base model instantiate.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># now remove types.yaml</span>
<span class="c1"># rm -f testdir/ecapa/config/types.yaml</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="c1"># Error instantiate TopVirtualModel</span>
<span class="c1"># Let&#39;s complete the model type</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;egrecho.models.ecapa.model.EcapaModel&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># Type is ok</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">EcapaModel</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># classname string is ok as EcapaModel is already imported</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;EcapaModel&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;Valle&#39;</span>
<span class="c1"># Error as &#39;Valle&#39; is not registed.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span>
    <span class="n">init_weight</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;anyinvalid.yaml&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># only load model without weight and eliminate the model_config.yaml of Ecapa model directory</span>
<span class="kn">from</span> <span class="nn">egrecho.models.valle.model</span> <span class="kn">import</span> <span class="n">Valle</span>
<span class="c1"># Try again.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span>
    <span class="n">init_weight</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;???.yaml&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Valle</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.fetch_from">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fetch_from</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dirpath</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">init_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pretrained'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_location</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_load_helper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L382-L432"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.fetch_from" title="Permalink to this definition">#</a></dt>
<dd><p>Fetch pretrained from a directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dirpath</strong> -- srcdir</p></li>
<li><p><strong>config</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]</span>) -- config path/dict which could override the underlying model init cfg (model_config.yaml).</p></li>
<li><p><strong>init_weight</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Literal</span></code>[<code class="docutils literal notranslate"><span class="pre">'pretrained'</span></code>, <code class="docutils literal notranslate"><span class="pre">'random'</span></code>], <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) -- Init weight from (â€˜pretrainedâ€™|â€™randomâ€™), or string ckpt
name (model_weight.ckpt) or full path to ckpt /path/to/model_weight.ckpt.
Default: <code class="docutils literal notranslate"><span class="pre">'pretrained'</span></code>.</p></li>
<li><p><strong>map_location</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">device</span></code>]</span>) -- MAP_LOCATION_TYPE as in torch.load().
Defaults to â€˜cpuâ€™.</p></li>
<li><p><strong>strict</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) -- Whether to strictly enforce that the keys in checkpoint match
the keys returned by this moduleâ€™s state dict.
Defaults: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>save_load_helper</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="loads.html#egrecho.core.loads.SaveLoadHelper" title="egrecho.core.loads.SaveLoadHelper"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveLoadHelper</span></code></a>]</span>) -- obj of save_load_helper
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>, which will initiate a default <a class="reference internal" href="loads.html#egrecho.core.loads.SaveLoadHelper" title="egrecho.core.loads.SaveLoadHelper"><code class="xref py py-class docutils literal notranslate"><span class="pre">SaveLoadHelper</span></code></a>.</p></li>
<li><p><strong>**kwargs</strong> (<em>Dict</em><em>[</em><em>str</em><em>,</em><em>Any</em><em>]</em>) -- additional parameters of model cfg.</p></li>
</ul>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">egrecho.models.ecapa.model</span> <span class="kn">import</span> <span class="n">EcapaModel</span>
<span class="kn">from</span> <span class="nn">egrecho.data.features.feature_extractor_audio</span> <span class="kn">import</span> <span class="n">KaldiFeatureExtractor</span>
<span class="n">extractor</span> <span class="o">=</span> <span class="n">KaldiFeatureExtractor</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="p">()</span>
<span class="n">dirpath</span> <span class="o">=</span> <span class="s1">&#39;testdir/ecapa&#39;</span>
<span class="n">model</span><span class="o">.</span><span class="n">save_to</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">extractor</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree testdir/ecapa
testdir/ecapa/
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ feature_config.yaml
â”‚   â”œâ”€â”€ model_config.yaml
â”‚   â””â”€â”€ types.yaml
â””â”€â”€ model_weight.ckpt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">EcapaModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># fetch extractor</span>
<span class="n">hresults</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">save_load_helper</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">skip_keys</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hresults</span><span class="o">.</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">KaldiFeatureExtractor</span><span class="p">)</span>
<span class="c1"># base model instantiate.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># now remove types.yaml</span>
<span class="c1"># rm -f testdir/ecapa/config/types.yaml</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
<span class="c1"># Error instantiate TopVirtualModel</span>
<span class="c1"># Let&#39;s complete the model type</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;egrecho.models.ecapa.model.EcapaModel&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># Type is ok</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="n">EcapaModel</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="c1"># classname string is ok as EcapaModel is already imported</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;EcapaModel&#39;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EcapaModel</span><span class="p">)</span>
<span class="n">model_cls</span> <span class="o">=</span> <span class="s1">&#39;Valle&#39;</span>
<span class="c1"># Error as &#39;Valle&#39; is not registed.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span>
    <span class="n">init_weight</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;anyinvalid.yaml&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># only load model without weight and eliminate the model_config.yaml of Ecapa model directory</span>
<span class="kn">from</span> <span class="nn">egrecho.models.valle.model</span> <span class="kn">import</span> <span class="n">Valle</span>
<span class="c1"># Try again.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TopVirtualModel</span><span class="o">.</span><span class="n">fetch_from</span><span class="p">(</span>
    <span class="n">dirpath</span><span class="p">,</span>
    <span class="n">_cls_</span><span class="o">=</span><span class="n">model_cls</span><span class="p">,</span>
    <span class="n">init_weight</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">config_fname</span><span class="o">=</span><span class="s1">&#39;???.yaml&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Valle</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.auto">
<span class="sig-name descname"><span class="pre">auto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L434-L436"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.auto" title="Permalink to this definition">#</a></dt>
<dd><p>It is convenient for forward-computing when layer could be None or not</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.export_onnx">
<span class="sig-name descname"><span class="pre">export_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/../../../../../../opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/torch/autograd/grad_mode.py#L445-L493"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.export_onnx" title="Permalink to this definition">#</a></dt>
<dd><p>Exports the model in ONNX format in tracing mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>]</span>) -- The path of the file the onnx model should be saved to.</p></li>
<li><p><strong>input_sample</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</span>) -- An input for tracing. Default: None (Use self.example_input_array)</p></li>
<li><p><strong>**kwargs</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></span>) -- Will be passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This general method may not appropriate for every model, you can override it for your specify model.
If you want a Scripting onnx model, you should</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
<span class="n">input_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">(</span><span class="s2">&quot;export.onnx&quot;</span><span class="p">,</span> <span class="n">input_sample</span><span class="p">,</span> <span class="n">export_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.TopVirtualModel.export_jit">
<span class="sig-name descname"><span class="pre">export_jit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'script'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/../../../../../../opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/torch/autograd/grad_mode.py#L495-L580"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.TopVirtualModel.export_jit" title="Permalink to this definition">#</a></dt>
<dd><p>Exports the model to a TorchScript representation for inference or saving.</p>
<p>By default, compiles the entire model to a <code class="xref py py-class docutils literal notranslate"><span class="pre">ScriptModule</span></code>.
If you prefer to use tracing, provide the argument <code class="docutils literal notranslate"><span class="pre">method='trace'</span></code> and ensure that either the <code class="docutils literal notranslate"><span class="pre">input_sample</span></code> argument
is provided or the model has <code class="xref py py-attr docutils literal notranslate"><span class="pre">example_input_array</span></code> set for tracing. To customize which modules are scripted,
you can override this method. To return multiple modules, use a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>]</em><em>]</em>) -- Path to save the TorchScript representation. Default: None (no file saved).</p></li>
<li><p><strong>method</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) -- Choose between â€˜scriptâ€™ (default) and â€˜traceâ€™ for TorchScript compilation methods.</p></li>
<li><p><strong>input_sample</strong> (<em>Optional</em><em>[</em><em>Any</em><em>]</em>) -- An input to be used for tracing when method is set to â€˜traceâ€™.</p></li>
<li><p><strong>Default</strong> -- None (uses <code class="xref py py-attr docutils literal notranslate"><span class="pre">example_input_array</span></code>) if available.</p></li>
<li><p><strong>**kwargs</strong> (<em>Any</em>) -- Additional arguments passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.script()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The exported script will be set to evaluation mode.</p></li>
<li><p>It is recommended to install the latest supported version of PyTorch for using this feature without limitations.</p></li>
</ul>
<p>Refer to the <code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.jit</span></code> documentation for supported features.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">export_jit</span><span class="p">(</span><span class="s2">&quot;exported_model.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The converted TorchScript representation.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Union[ScriptModule, Dict[str, ScriptModule]]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.module.DataModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.module.</span></span><span class="sig-name descname"><span class="pre">DataModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefetch_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_num_workers</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pin_memory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fullsync</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">extra_dl_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L595-L724"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.DataModule" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LightningDataModule</span></code></p>
<p>A simple lightning datamodule wrapper for dataloader.</p>
<p>The iterable dataset in <code class="xref py py-class docutils literal notranslate"><span class="pre">IterabelDatasetWrapper</span></code> auto sharding samples in
different ranks, we should load the dataset in hook: <code class="xref py py-meth docutils literal notranslate"><span class="pre">setup()</span></code> as this hook is
called on every process when using DDP.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder</strong> (<a class="reference internal" href="data_builder.html#egrecho.core.data_builder.DataBuilder" title="egrecho.core.data_builder.DataBuilder"><em>DataBuilder</em></a>) -- The data builder instance of <a class="reference internal" href="data_builder.html#egrecho.core.data_builder.DataBuilder" title="egrecho.core.data_builder.DataBuilder"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataBuilder</span></code></a>
responsible for creating the dataset.</p></li>
<li><p><strong>batch_size</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) -- The batch size for DataLoader. Default is None for iterable dataset.</p></li>
<li><p><strong>num_workers</strong> (<em>int</em>) -- The number of workers for DataLoader. Default is 0.</p></li>
<li><p><strong>prefetch_factor</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) -- The prefetch factor for DataLoader. Default is None.</p></li>
<li><p><strong>val_num_workers</strong> (<em>Optional</em><em>[</em><em>int</em><em>]</em>) -- The number of workers for validation DataLoader. Defaults to 0. If
set None it will use the same number of workers as <cite>num_workers</cite>.</p></li>
<li><p><strong>pin_memory</strong> (<em>bool</em>) -- Whether to pin memory in DataLoader. Default is True.</p></li>
<li><p><strong>fullsync</strong> (<em>bool</em>) -- Whether to use <code class="xref py py-class docutils literal notranslate"><span class="pre">SyncDataLoader</span></code>. Default is True.</p></li>
<li><p><strong>**extra_dl_kwargs</strong> -- Additional keyword arguments to pass to DataLoader.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.module.DataModule.setup_data">
<span class="sig-name descname"><span class="pre">setup_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/module.py#L652-L662"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.module.DataModule.setup_data" title="Permalink to this definition">#</a></dt>
<dd><p>Builds datasets and assigns dataloader func to lightning datamodule.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="egrecho.core.module.DataModule.train_dataset">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">train_dataset</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#egrecho.core.module.DataModule.train_dataset" title="Permalink to this definition">#</a></dt>
<dd><p>This property returns the train dataset.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="egrecho.core.module.DataModule.val_dataset">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">val_dataset</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#egrecho.core.module.DataModule.val_dataset" title="Permalink to this definition">#</a></dt>
<dd><p>This property returns the validation dataset.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="egrecho.core.module.DataModule.test_dataset">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">test_dataset</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#egrecho.core.module.DataModule.test_dataset" title="Permalink to this definition">#</a></dt>
<dd><p>This property returns the test dataset.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-egrecho.core.model_base"></span><dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModuleConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.model_base.</span></span><span class="sig-name descname"><span class="pre">ModuleConfig</span></span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/model_base.py#L21-L25"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.model_base.ModuleConfig" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <a class="reference internal" href="config.html#egrecho.core.config.DataclassConfig" title="egrecho.core.config.DataclassConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataclassConfig</span></code></a></p>
<p>Base class for model configuration.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModelBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">egrecho.core.model_base.</span></span><span class="sig-name descname"><span class="pre">ModelBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/model_base.py#L66-L261"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.model_base.ModelBase" title="Permalink to this definition">#</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ModuleUtilMixin</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></p>
<p>A virtual backbone that provides common utilities.</p>
<p>Its implementation is used to aggregate components of submodules to a model.</p>
<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModelBase.post_init">
<span class="sig-name descname"><span class="pre">post_init</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/core/model_base.py#L82-L86"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.model_base.ModelBase.post_init" title="Permalink to this definition">#</a></dt>
<dd><p>Gives a chance to perform additional operations at the end of the modelâ€™s initialization process.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModelBase.dummy_inputs">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dummy_inputs</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#egrecho.core.model_base.ModelBase.dummy_inputs" title="Permalink to this definition">#</a></dt>
<dd><p>Dummy inputs to do a forward pass in the network.</p>
<p>The return type is interpreted as follows:</p>
<ul class="simple">
<li><p>Single tensor: It is assumed the model takes a single argument, i.e.,
<code class="docutils literal notranslate"><span class="pre">model.forward(model.dummy_inputs)</span></code>.</p></li>
<li><p>Tuple: The inputs is interpreted as a sequence of positional arguments, i.e.,
<code class="docutils literal notranslate"><span class="pre">model.forward(*model.dummy_inputs)</span></code>.</p></li>
<li><p>Dict: The input array represents named keyword arguments, i.e.,
<code class="docutils literal notranslate"><span class="pre">model.forward(**model.dummy_inputs)</span></code>.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModelBase.export_onnx">
<span class="sig-name descname"><span class="pre">export_onnx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/../../../../../../opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/torch/autograd/grad_mode.py#L126-L174"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.model_base.ModelBase.export_onnx" title="Permalink to this definition">#</a></dt>
<dd><p>Exports the model in ONNX format in tracing mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Path</span></code>]</span>) -- The path of the file the onnx model should be saved to.</p></li>
<li><p><strong>input_sample</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]</span>) -- An input for tracing. Default: None (Use <a class="reference internal" href="#egrecho.core.model_base.ModelBase.dummy_inputs" title="egrecho.core.model_base.ModelBase.dummy_inputs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dummy_inputs</span></code></a>)</p></li>
<li><p><strong>**kwargs</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code></span>) -- Will be passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.onnx.export()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This general method may not appropriate for every model, you can override it for your specify model.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
<span class="n">input_sample</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">export_onnx</span><span class="p">(</span><span class="s2">&quot;export.onnx&quot;</span><span class="p">,</span> <span class="n">input_sample</span><span class="p">,</span> <span class="n">export_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="egrecho.core.model_base.ModelBase.export_jit">
<span class="sig-name descname"><span class="pre">export_jit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'script'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/wangers/subtools2/tree/master/egrecho/../../../../../../opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/torch/autograd/grad_mode.py#L176-L261"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#egrecho.core.model_base.ModelBase.export_jit" title="Permalink to this definition">#</a></dt>
<dd><p>Exports the model to a TorchScript representation for inference or saving.</p>
<p>By default, compiles the entire model to a <code class="xref py py-class docutils literal notranslate"><span class="pre">ScriptModule</span></code>.
If you prefer to use tracing, provide the argument <code class="docutils literal notranslate"><span class="pre">method='trace'</span></code> and
ensure that either the <code class="docutils literal notranslate"><span class="pre">input_sample</span></code> argument is provided or the model
has <a class="reference internal" href="#egrecho.core.model_base.ModelBase.dummy_inputs" title="egrecho.core.model_base.ModelBase.dummy_inputs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dummy_inputs</span></code></a> set for tracing. To customize which modules are scripted,
you can override this method. To return multiple modules, use a dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> (<em>Optional</em><em>[</em><em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>]</em><em>]</em>) -- Path to save the TorchScript representation.
Default: None (no file saved).</p></li>
<li><p><strong>method</strong> (<em>Optional</em><em>[</em><em>str</em><em>]</em>) -- Choose between â€˜scriptâ€™ (default) and â€˜traceâ€™ for TorchScript compilation methods.</p></li>
<li><p><strong>input_sample</strong> (<em>Optional</em><em>[</em><em>Any</em><em>]</em>) -- An input to be used for tracing when method is set to â€˜traceâ€™.
Default: None (uses <a class="reference internal" href="#egrecho.core.model_base.ModelBase.dummy_inputs" title="egrecho.core.model_base.ModelBase.dummy_inputs"><code class="xref py py-attr docutils literal notranslate"><span class="pre">dummy_inputs</span></code></a>) if available.</p></li>
<li><p><strong>**kwargs</strong> (<em>Any</em>) -- Additional arguments passed to <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.script()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">torch.jit.trace()</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The exported script will be set to evaluation mode.</p></li>
<li><p>It is recommended to install the latest supported version of PyTorch for using this feature without limitations.</p></li>
</ul>
<p>Refer to the pytorch <code class="xref py py-mod docutils literal notranslate"><span class="pre">torch.jit</span></code> documentation for supported features.</p>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleModel</span><span class="p">(</span><span class="n">TopVirtualModule</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleModel</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">export_jit</span><span class="p">(</span><span class="s2">&quot;exported_model.pt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The converted TorchScript representation.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Union[ScriptModule, Dict[str, ScriptModule]]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="optimization.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">egrecho.core.optimization</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="loads.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">egrecho.core.loads</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Dexin Liao
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">egrecho.core.module</a><ul>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel</span></code></a><ul>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.setup"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.setup()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.training_step"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.training_step()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.validation_step"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.validation_step()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.pipeline_out"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.pipeline_out()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.on_train_start"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.on_train_start()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.on_train_end"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.on_train_end()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.configure_optimizers"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.configure_optimizers()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.configure_teacher_callbacks"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.configure_teacher_callbacks()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.from_pretrained"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.from_pretrained()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.save_to"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.save_to()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.fetch_from"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.fetch_from()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.auto"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.auto()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.export_onnx"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.export_onnx()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.TopVirtualModel.export_jit"><code class="docutils literal notranslate"><span class="pre">TopVirtualModel.export_jit()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#egrecho.core.module.DataModule"><code class="docutils literal notranslate"><span class="pre">DataModule</span></code></a><ul>
<li><a class="reference internal" href="#egrecho.core.module.DataModule.setup_data"><code class="docutils literal notranslate"><span class="pre">DataModule.setup_data()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.DataModule.train_dataset"><code class="docutils literal notranslate"><span class="pre">DataModule.train_dataset</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.DataModule.val_dataset"><code class="docutils literal notranslate"><span class="pre">DataModule.val_dataset</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.module.DataModule.test_dataset"><code class="docutils literal notranslate"><span class="pre">DataModule.test_dataset</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#egrecho.core.model_base.ModuleConfig"><code class="docutils literal notranslate"><span class="pre">ModuleConfig</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.model_base.ModelBase"><code class="docutils literal notranslate"><span class="pre">ModelBase</span></code></a><ul>
<li><a class="reference internal" href="#egrecho.core.model_base.ModelBase.post_init"><code class="docutils literal notranslate"><span class="pre">ModelBase.post_init()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.model_base.ModelBase.dummy_inputs"><code class="docutils literal notranslate"><span class="pre">ModelBase.dummy_inputs</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.model_base.ModelBase.export_onnx"><code class="docutils literal notranslate"><span class="pre">ModelBase.export_onnx()</span></code></a></li>
<li><a class="reference internal" href="#egrecho.core.model_base.ModelBase.export_jit"><code class="docutils literal notranslate"><span class="pre">ModelBase.export_jit()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=b3ba4146"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=4ea706d9"></script>
    <script src="../../_static/tabs.js?v=3ee01567"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>